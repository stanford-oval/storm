# Backend Requirements for STORM UI (Pinned Versions)
# Compatible with Python 3.11+
# Tested on macOS (ARM64) and Windows (x64)

# =========================
# FastAPI & Server
# =========================
fastapi==0.109.2
uvicorn[standard]==0.24.0
starlette==0.36.3
python-multipart==0.0.18  # Updated to fix DoS vulnerability (CVE-2024-53981)

# =========================
# Data Validation & Models
# =========================
pydantic==2.11.7
pydantic-core==2.33.2
typing-extensions==4.15.0
annotated-types==0.7.0

# =========================
# File Processing
# =========================
python-frontmatter==1.0.0
aiofiles==23.2.1
pathlib2==2.3.7.post1
markdown2==2.5.4

# =========================
# Date & Time
# =========================
python-dateutil==2.9.0.post0
pytz==2025.2
six==1.17.0

# =========================
# Security & Authentication
# =========================
PyJWT==2.8.0  # Secure JWT implementation (replaces vulnerable python-jose)
passlib[bcrypt]==1.7.4
bcrypt==4.3.0
cryptography==44.0.1  # Updated to fix OpenSSL vulnerabilities (GHSA-h4gh-qq45-vh27, CVE-2024-12797)
cffi==1.16.0  # Updated to latest stable
pycparser==2.23

# =========================
# HTTP Client
# =========================
httpx==0.28.1
httpcore==1.0.9
h11==0.16.0
anyio==4.10.0
sniffio==1.3.1

# =========================
# Utilities
# =========================
pyyaml==6.0.2
click==8.2.1
python-dotenv==1.1.1
certifi==2025.8.3
idna==3.10
urllib3==2.5.0

# =========================
# Uvicorn Extensions
# =========================
httptools==0.6.4
uvloop==0.21.0; sys_platform != 'win32'
watchfiles==1.1.0
websockets==15.0.1

# =========================
# Development Tools (Optional)
# =========================
pytest==7.4.3
pytest-asyncio==0.21.1
black==24.3.0  # Updated to fix ReDoS vulnerability (CVE-2024-21503)
isort==5.12.0
mypy==1.7.1
mypy-extensions==1.1.0
pathspec==0.12.1
platformdirs==4.4.0
pluggy==1.6.0
iniconfig==2.1.0

# =========================
# Type Stubs (Optional)
# =========================
types-requests==2.31.0.10
types-toml==0.10.8.7
types-pytz==2024.1.0.20240203

# =========================
# Installation Notes
# =========================
# Install with: pip install -r requirements-backend.txt
#
# IMPORTANT: Install STORM core first:
# cd .. && pip install -e .
# OR
# pip install knowledge-storm
#
# Platform-Specific Notes:
#
# macOS:
# - uvloop provides better async performance on Unix systems
# - watchfiles uses Rust, may need cargo installed
#
# Windows:
# - uvloop not available (automatically skipped)
# - May need Visual C++ Build Tools for some packages
# - Use: pip install --only-binary :all: <package> if compilation fails
#
# Docker Deployment:
# - Use python:3.11-slim base image
# - Install build-essential for compilation: apt-get install build-essential
#
# Production:
# - Remove development tools section
# - Use: pip install --no-cache-dir -r requirements-backend.txt
# - Consider using gunicorn instead of uvicorn for production